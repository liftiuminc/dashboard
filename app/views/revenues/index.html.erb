<% title "Revenue Data Entry" %>

<%= render :partial => 'selector', :locals => { :show_submit => true } %>

<% if @tags %>
    <table class="record_listing" width="500" cellspacing="0" cellpadding="0"><!-- Cellspacing/padding added for IE 6 -->
      <tr class="record_listing_header">
        <th>Network</th>
        <th>Publisher</th>
        <th>Login</th>
        <th>Size</th>
        <th>Impressions</th>
        <th>Clicks</th>
        <th>Revenue</th>
        <th>eCPM</th>
        <th>Actions</th>
        <th>Instructions</th>
      </tr>
      <% for tag in @tags %>
        <% pnl = PublisherNetworkLogin.first( :conditions => { 
                    :publisher_id   => tag.publisher_id,
                    :network_id     => tag.network_id } )
                    
           rev = Revenue.first( :conditions => { :tag_id   => tag.id  } )
        %>                    

        <tr class="record_row_<%= cycle("odd", "even")%>">
          <td class="record_column"><%= link_to tag.network.network_name, tag.network %></td>

          <td class="record_column"><%= link_to tag.publisher.site_name, tag.publisher %></td>
          <td class="record_column">
            <%= render :partial => "shared/publisher_network_login_button", 
                       :locals  => { :pnl => pnl, :network => tag.network, :show_hint => 1 } %>
          </td>
          <td class="record_column"><%= link_to tag.size, tag, :action => :show %><br><span class="hint"><%=h tag.tag_name %></span></td>
          <td class="record_column"><%=h rev ? number_with_delimiter(rev.attempts) : "?"  %></td>
          <td class="record_column"><%=h rev ? number_with_delimiter(rev.clicks)   : "?"  %></td>
          <td class="record_column">$<%=h rev ? rev.revenue  : "?"  %></td>          
          <td class="record_column">$<%=h rev ? rev.ecpm.to_f.round(3) : "?"  %></td>          
 
              <td class="record_column" nowrap="true">
          	<% if rev %>
		  <%= link_to "View", rev, :action => :show, :popup => true %>
                  <%= link_to "Edit", edit_revenue_path(rev), :popup => true %>
             	  <%= link_to "Delete", rev, :confirm => 'Are you sure?', :method => "delete" %>
		<% else %>
		  <%= '<a href="' + new_revenue_path + '"><img alt="" src="/images/icons/add.png"></a> ' + (link_to "Create", new_revenue_path(:tag_id => tag.id, :day => @day.to_s ), :popup => true ) %>
                <% end %>
	      </td>
          <td class="record_column"><span title="<%=h tag.network.scraping_instructions %>" class="comments"><%= truncate(tag.network.scraping_instructions, :length=> 150) %></td>          
        </tr>
      <% end %>
    </table>
<% end %>

